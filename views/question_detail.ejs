<!DOCTYPE html>
<html lang="en">
<head>
    <title><%= question.title %></title>
    <script>
        async function vote(answerId, voteType) {
            const upBtn = document.getElementById(`upvote-${answerId}`);
            const downBtn = document.getElementById(`downvote-${answerId}`);
            upBtn.disabled = true;
            downBtn.disabled = true;

            const response = await fetch('/answers/vote', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ answer_id: answerId, vote: voteType })
            });

            if (response.ok) {
                const data = await response.json();
                if (data.success) {
                    document.getElementById(`votes-${answerId}`).innerText = data.votes;
                } else {
                    alert(data.message || "You have already voted.");
                }
            } else {
                alert("Error while voting.");
            }

            upBtn.disabled = false;
            downBtn.disabled = false;
        }
    </script>
    <link rel="stylesheet" href="/views/question_d.css">
</head>
<body>
    <h2><%= question.title %></h2>
    <p><%= question.description %></p>

    <h3>Answers:</h3>
    <ul>
        <% answers.forEach(ans => { %>
            <li>
                <p>
                    <%= ans.content %> - Votes: <span id="votes-<%= ans.id %>"><%= ans.votes %></span>
                </p>
                <button id="upvote-<%= ans.id %>" onclick="vote(<%= ans.id %>, 'up')">Upvote</button>
                <button id="downvote-<%= ans.id %>" onclick="vote(<%= ans.id %>, 'down')">Downvote</button>
            </li>
        <% }) %>
    </ul>

    <h3>Post an Answer:</h3>
    <form action="/answers/new" method="POST">
        <input type="hidden" name="question_id" value="<%= question.id %>">
        <textarea name="content" required></textarea>
        <button type="submit">Submit</button>
    </form>
    
    <a href="/questions">Back to Questions</a>
</body>
</html>
