<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= courseData.title %> - Course Details</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />

    <style>
      /* Base Styles and Variables */
      :root {
        --primary-purple: #8b5cf6;
        --primary-light: #a78bfa;
        --cyan-accent: #b8e0dc;
        --yellow-accent: #fef3c7;
        --background: #f5f5f5;
        --white: #ffffff;
        --text-dark: #2d3748;
        --text-medium: #4a5568;
        --text-light: #718096;
        --success-color: #10b981;
        --warning-color: #f59e0b;
        --border-radius: 16px;
        --transition: all 0.3s ease;
        --font-main: "Poppins", sans-serif;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: var(--font-main);
        color: var(--text-dark);
        font-size: 16px;
        background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
        position: relative;
        overflow-x: hidden;
        padding-top: 130px;
      }

      body::before {
        content: "";
        position: fixed;
        top: 10%;
        right: 5%;
        width: 400px;
        height: 400px;
        background: var(--cyan-accent);
        opacity: 0.2;
        border-radius: 50%;
        filter: blur(80px);
        animation: float 8s ease-in-out infinite;
        z-index: 0;
      }

      body::after {
        content: "";
        position: fixed;
        bottom: 10%;
        left: 5%;
        width: 300px;
        height: 300px;
        background: var(--yellow-accent);
        opacity: 0.25;
        border-radius: 50%;
        filter: blur(80px);
        animation: float 10s ease-in-out infinite reverse;
        z-index: 0;
      }

      @keyframes float {
        0%,
        100% {
          transform: translate(0, 0) scale(1);
        }
        50% {
          transform: translate(30px, -30px) scale(1.1);
        }
      }

      .geometric-shape {
        position: fixed;
        background: var(--cyan-accent);
        opacity: 0.12;
        z-index: 0;
      }

      .shape-1 {
        top: 20%;
        left: 10%;
        width: 100px;
        height: 100px;
        border-radius: 50%;
        animation: float 7s ease-in-out infinite;
      }

      .shape-2 {
        bottom: 25%;
        right: 15%;
        width: 140px;
        height: 140px;
        border-radius: 25px;
        transform: rotate(45deg);
        animation: rotate 20s linear infinite;
      }

      .shape-3 {
        top: 45%;
        right: 8%;
        width: 70px;
        height: 70px;
        border-radius: 50%;
        background: var(--yellow-accent);
        opacity: 0.18;
        animation: pulse 5s ease-in-out infinite;
      }

      @keyframes rotate {
        from {
          transform: rotate(45deg);
        }
        to {
          transform: rotate(405deg);
        }
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 0.15;
        }
        50% {
          transform: scale(1.2);
          opacity: 0.25;
        }
      }

      .container {
        width: 90%;
        max-width: 1200px;
        margin: auto;
        position: relative;
        z-index: 1;
      }

      .course-info {
        background: var(--white);
        padding: 60px 40px;
        margin: 20px auto 40px auto;
        border-radius: var(--border-radius);
        text-align: center;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
        position: relative;
        overflow: hidden;
        transition: var(--transition);
      }

      .course-info:hover {
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.12);
        transform: translateY(-5px);
      }

      .course-info::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 6px;
        background: linear-gradient(
          135deg,
          var(--primary-purple) 0%,
          var(--primary-light) 100%
        );
      }

      .course-info h1 {
        font-size: 2.8em;
        margin-bottom: 20px;
        color: var(--text-dark);
        font-weight: 700;
        background: linear-gradient(
          135deg,
          var(--primary-purple) 0%,
          var(--primary-light) 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .course-info > p {
        font-size: 1.15em;
        margin-bottom: 30px;
        line-height: 1.7;
        color: var(--text-medium);
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
      }

      .course-info button {
        background: linear-gradient(
          135deg,
          var(--primary-purple) 0%,
          var(--primary-light) 100%
        );
        color: white;
        padding: 16px 40px;
        border: none;
        border-radius: 12px;
        font-size: 1.1em;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        box-shadow: 0 8px 20px rgba(139, 92, 246, 0.25);
        font-family: var(--font-main);
        position: relative;
        overflow: hidden;
      }

      .course-info button::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        transition: left 0.6s ease;
      }

      .course-info button:hover::before {
        left: 100%;
      }

      .course-info button:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 28px rgba(139, 92, 246, 0.35);
      }

      .course-info a {
        color: var(--primary-purple);
        text-decoration: none;
        transition: var(--transition);
        font-weight: 600;
        position: relative;
      }

      .course-info a::after {
        content: "";
        position: absolute;
        width: 0;
        height: 2px;
        bottom: -2px;
        left: 0;
        background: var(--primary-purple);
        transition: width 0.3s ease;
      }

      .course-info a:hover::after {
        width: 100%;
      }

      .course-info a:hover {
        color: var(--primary-light);
      }

      .enrollment-info {
        margin: 25px 0;
        font-size: 1.05em;
        color: var(--text-medium);
      }

      .course-info .details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 40px;
      }

      .course-info .details div {
        padding: 20px;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        background: #fafafa;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        text-align: center;
        color: var(--text-dark);
        transition: var(--transition);
        cursor: pointer;
        font-weight: 500;
      }

      .course-info .details div i {
        display: block;
        font-size: 2em;
        margin-bottom: 10px;
        color: var(--primary-purple);
      }

      .course-info .details div:hover {
        background: linear-gradient(
          135deg,
          var(--primary-purple) 0%,
          var(--primary-light) 100%
        );
        color: white;
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(139, 92, 246, 0.3);
        border-color: var(--primary-purple);
      }

      .course-info .details div:hover i {
        color: white;
      }

      section {
        background: var(--white);
        padding: 50px 40px;
        margin: 30px 0;
        border-radius: var(--border-radius);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
        transition: var(--transition);
      }

      section:hover {
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.12);
        transform: translateY(-3px);
      }

      section h2 {
        font-size: 2em;
        margin-bottom: 25px;
        color: var(--text-dark);
        text-align: left;
        position: relative;
        padding-left: 25px;
        font-weight: 700;
      }

      section h2::before {
        content: "";
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 6px;
        height: 40px;
        background: linear-gradient(
          135deg,
          var(--primary-purple) 0%,
          var(--primary-light) 100%
        );
        border-radius: 3px;
      }

      section p {
        font-size: 1.05em;
        line-height: 1.8;
        text-align: left;
        padding-left: 25px;
        color: var(--text-medium);
      }

      section ul {
        padding-left: 45px;
        margin-top: 20px;
      }

      section li {
        font-size: 1.05em;
        line-height: 1.8;
        color: var(--text-medium);
        margin-bottom: 12px;
        position: relative;
      }

      section li::before {
        content: "âœ“";
        position: absolute;
        left: -25px;
        color: var(--success-color);
        font-weight: bold;
      }

      /* Instructor Section Specific Styles */
      .instructor-details {
        display: flex;
        flex-direction: column;
        gap: 15px;
        padding-left: 25px;
        text-align: left;
      }

      .instructor-bio-card {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 20px;
      }

      .instructor-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid var(--primary-purple);
      }

      .instructor-text h4 {
        font-size: 1.2em;
        font-weight: 600;
        color: var(--primary-purple);
        margin-bottom: 5px;
      }

      .instructor-text p {
        font-size: 0.95em;
        padding-left: 0;
        color: var(--text-light);
      }

      /* Responsive Design */
      @media screen and (max-width: 992px) {
        .course-info h1 {
          font-size: 2.2em;
        }

        .course-info .details {
          grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
          gap: 15px;
        }
      }

      @media screen and (max-width: 768px) {
        .izumi-navbar {
          flex-direction: column;
          align-items: flex-start;
          padding: 1rem 1.5rem;
        }
        .izumi-navbar-brand {
          margin-bottom: 1rem;
        }
        .izumi-nav-links {
          width: 100%;
          justify-content: space-around;
          gap: 0;
          overflow-x: auto;
          white-space: nowrap;
          margin-top: 0.5rem;
        }
        .izumi-nav-links .course-nav-link {
          margin: 0 5px;
          padding: 8px 10px;
          font-size: 0.9em;
        }
        .izumi-profile-container {
          position: absolute;
          top: 1rem;
          right: 1.5rem;
        }
        body {
          padding-top: 180px;
        }

        .course-info {
          padding: 40px 30px;
        }

        .course-info h1 {
          font-size: 1.8em;
        }

        .course-info .details {
          grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
          gap: 12px;
        }

        section {
          padding: 35px 25px;
        }

        section h2 {
          font-size: 1.6em;
        }

        section p {
          padding-left: 20px;
        }

        .instructor-bio-card {
          flex-direction: column;
          text-align: center;
          margin-bottom: 10px;
        }
        .instructor-text h4 {
          margin-top: 10px;
        }
      }

      @media screen and (max-width: 576px) {
        .course-info h1 {
          font-size: 1.5em;
        }

        .course-info button {
          padding: 14px 30px;
          font-size: 1em;
        }

        .course-info .details {
          grid-template-columns: 1fr;
        }

        section h2 {
          font-size: 1.4em;
        }

        section p {
          padding-left: 20px;
        }
      }

      /* Izumi Navbar Styles - CRITICAL CHANGES HERE */
      .izumi-navbar {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        flex-wrap: wrap;
        border-radius: 0;
        background: linear-gradient(
          135deg,
          var(--primary-purple) 0%,
          var(--primary-light) 100%
        );
        color: white;
        display: flex;
        align-items: center;
        padding: 1rem 2.5rem;
        z-index: 1000;
        box-shadow: 0 4px 20px rgba(139, 92, 246, 0.3);
      }

      .izumi-navbar-brand {
        font-size: 1.5rem;
        font-weight: 700;
        letter-spacing: 1px;
        margin-right: 2.5rem;
      }

      .izumi-nav-links {
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      /* MODIFIED STYLE FOR HOME LINK - CLEANER PILL SHAPE */
      .izumi-nav-link-active {
        font-weight: 600;
        padding: 0.5rem 1.1rem;
        background-color: rgba(255, 255, 255, 0.25);
        border-radius: 50px;
        color: white;
        text-decoration: none;
        transition: var(--transition);
        margin-right: 1.2rem;
        display: inline-block;
      }

      .izumi-nav-link-active:hover {
        background-color: rgba(255, 255, 255, 0.4);
      }

      /* Modified styles for the merged course links */
      .izumi-nav-links .course-nav-link {
        padding: 0.75rem 1.25rem;
        background: none;
        border: none;
        font-size: 1em;
        font-weight: 500;
        color: white;
        cursor: pointer;
        transition: var(--transition);
        position: relative;
        text-decoration: none;
        border-radius: 8px;
        display: inline-block;
        margin: 0 5px;
      }

      .izumi-nav-links .course-nav-link:hover {
        background-color: rgba(255, 255, 255, 0.15);
      }

      .izumi-nav-links .course-nav-link.active-course-link {
        font-weight: 600;
        background-color: rgba(0, 0, 0, 0.1);
      }

      .izumi-profile-container {
        margin-left: auto;
        position: relative;
        cursor: pointer;
        width: 44px;
        height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: var(--transition);
        background: rgba(255, 255, 255, 0.1);
      }
      .izumi-profile-container:hover {
        background-color: rgba(255, 255, 255, 0.2);
      }

      .izumi-profile-icon {
        font-size: 20px;
        color: white;
      }

      .izumi-dropdown-content {
        display: none;
        position: absolute;
        right: 0;
        top: 55px;
        background: white;
        min-width: 250px;
        border-radius: 12px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        transform-origin: top right;
        animation: scaleIn 0.2s ease-out;
        overflow: hidden;
        z-index: 1001;
      }

      @keyframes scaleIn {
        from {
          transform: scale(0.95);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }

      .izumi-dropdown-content.active {
        display: block;
      }

      .izumi-dropdown-items {
        padding: 0.5rem 0;
      }

      .izumi-dropdown-item {
        padding: 0.875rem 1.25rem;
        color: var(--text-dark);
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 0.875rem;
        font-size: 0.95rem;
        transition: var(--transition);
        font-weight: 500;
      }

      .izumi-dropdown-item:hover {
        background: #f0f4ff;
        color: var(--primary-purple);
      }

      .izumi-dropdown-item i {
        width: 1.25rem;
        text-align: center;
        color: var(--primary-light);
      }

      .izumi-logout {
        color: #dc3545 !important;
      }

      .izumi-logout i {
        color: #dc3545 !important;
      }

      .izumi-divider {
        border-top: 1px solid #e2e8f0;
        margin: 0.5rem 0;
      }
    </style>
  </head>
  <body>
    <div class="geometric-shape shape-1"></div>
    <div class="geometric-shape shape-2"></div>
    <div class="geometric-shape shape-3"></div>

    <% 
      const details = (courseData && courseData.details) ? courseData.details : {}; 
      const rating = (typeof details.rating !== 'undefined') ? details.rating : 'N/A'; 
      const reviewsCount = (typeof details.reviewsCount !== 'undefined') ? details.reviewsCount : 0; 
      const level = details.level || 'Not specified'; 
      const duration = details.duration || 'Not specified'; 
      const flexibility = details.flexibility || 'Not specified'; 
      const completionTimeEstimate = details.completionTimeEstimate || 'Not specified'; 
      const enrollmentCountSafe = (courseData && typeof courseData.enrollmentCount === 'number') ? courseData.enrollmentCount : 0;
      const instructor = (courseData && courseData.instructor) ? courseData.instructor : { name: 'TBA', title: '', bio: '', avatarUrl: '/images/default-avatar.png' };
      const sampleReviews = Array.isArray(courseData && courseData.sampleReviews) ? courseData.sampleReviews : [];
      const whatYouWillLearn = Array.isArray(courseData && courseData.whatYouWillLearn) ? courseData.whatYouWillLearn : [];
    %>
    
    <nav class="izumi-navbar">
      <div class="izumi-navbar-brand">Izumi</div>
      <div class="izumi-nav-links">
        <a
          href="http://localhost:4000/"
          class="izumi-nav-link-active"
          data-page="home"
          >Home</a
        >
        <a href="#overview" class="course-nav-link active-course-link"
          >Overview</a
        >
        <a href="#curriculum" class="course-nav-link">Curriculum</a>
        <a href="#instructor" class="course-nav-link">Instructor</a>
        <a href="#reviews" class="course-nav-link">Reviews</a>
        <a href="#requirements" class="course-nav-link">Requirements</a>
        <a href="#outcomes" class="course-nav-link">Learning Outcomes</a>
      </div>
      <div
        class="izumi-profile-container"
        aria-label="User menu"
        role="button"
        tabindex="0"
      >
        <i class="fa-solid fa-ellipsis-h izumi-profile-icon"></i>
        <div class="izumi-dropdown-content" role="menu">
  <div class="izumi-dropdown-items">
    <a href="/profile" class="izumi-dropdown-item" role="menuitem"
      ><i class="fa-regular fa-user"></i>Profile</a
    >
    <a href="#" class="izumi-dropdown-item" role="menuitem"
      ><i class="fa-regular fa-credit-card"></i>My Purchases</a
    >
    <a href="/delete-page" class="izumi-dropdown-item" role="menuitem"
      ><i class="fa-solid fa-gear"></i>Settings</a
    >
    <!--
    <a href="#" class="izumi-dropdown-item" role="menuitem"
      ><i class="fa-regular fa-bell"></i>Updates</a
    >
    -->
    <!-- <div class="izumi-divider" role="separator"></div> -->
    <!--
    <a href="#" class="izumi-dropdown-item" role="menuitem"
      ><i class="fa-regular fa-star"></i>Accomplishments</a
    >
    <a href="#" class="izumi-dropdown-item" role="menuitem"
      ><i class="fa-regular fa-circle-question"></i>Help Center</a
    >
    <div class="izumi-divider" role="separator"></div>
    -->
    <a
      href="/logout"
      class="izumi-dropdown-item izumi-logout"
      role="menuitem"
      ><i class="fa-solid fa-arrow-right-from-bracket"></i>Log Out</a
    >
  </div>
</div>
      </div>
    </nav>
    <div class="container">
      <div class="course-info">
        <h1><%= courseData.title %></h1>
        <p><%= courseData.tagline %></p>
        <a href="/enroll?courseId=<%= courseData.id %>">
          <button><i class="fas fa-check-circle"></i> Enroll Now</button>
        </a>
        <p class="enrollment-info">
          <strong><%= enrollmentCountSafe.toLocaleString() %></strong> students
          enrolled. <a href="#reviews">Read reviews</a>
        </p>

        <div class="details">
          <div>
            <i class="fas fa-star"></i>
            <strong>Average Rating</strong><br />
            <%= rating %> <span style="color: #f59e0b">â˜…</span>
          </div>
          <div>
            <i class="fas fa-comment-dots"></i>
            <strong>Reviews</strong><br />
            <%= reviewsCount.toLocaleString() %> reviews
          </div>
          <div>
            <i class="fas fa-signal"></i>
            <strong>Level</strong><br />
            <%= level %>
          </div>
          <div>
            <i class="fas fa-clock"></i>
            <strong>Duration</strong><br />
            <%= duration %>
          </div>
          <div>
            <i class="fas fa-calendar-check"></i>
            <strong>Flexibility</strong><br />
            <%= flexibility %>
          </div>
          <div>
            <i class="fas fa-hourglass-half"></i>
            <strong>Completion Time</strong><br />
            <%= completionTimeEstimate %>
          </div>
        </div>
      </div>

      <section id="overview">
        <h2>Course Overview</h2>
        <p><%= courseData.overview %></p>
      </section>

      <section id="curriculum">
        <h2>What You'll Learn</h2>
        <ul>
          <% whatYouWillLearn.forEach(function(item) { %>
          <li><%= item %></li>
          <% }); %>
        </ul>
      </section>

      <section id="instructor">
        <h2>About the Instructor</h2>
        <div class="instructor-details">
          <div class="instructor-bio-card">
            <img
              src="<%= instructor.avatarUrl %>"
              alt="<%= instructor.name %>"
              class="instructor-avatar"
            />
            <div class="instructor-text">
              <h4><%= instructor.name %></h4>
              <p><%= instructor.title %></p>
            </div>
          </div>
          <p><%= instructor.bio %></p>
        </div>
      </section>

      <section id="reviews">
        <h2>Student Reviews</h2>
        <% sampleReviews.forEach(function(review) { %>
        <p>
          "<%= review.text %>" - <strong><%= review.reviewer %></strong> (Rated:
          <%= review.rating %> â˜…)
        </p>
        <% }); %>
        <p style="padding-left: 25px; margin-top: 20px">
          <a href="#">See all <%= reviewsCount.toLocaleString() %> reviews</a>
        </p>
      </section>

      <section id="requirements">
        <h2>Requirements</h2>
        <ul>
          <li>A computer (Windows, Mac, or Linux)</li>
          <li>Internet connection for accessing course materials</li>
          <li>No prior programming experience required</li>
          <li>Willingness to learn and practice regularly</li>
          <li>Basic computer literacy (using browsers, installing software)</li>
        </ul>
      </section>

      <section id="outcomes">
        <h2>Learning Outcomes</h2>
        <p>By the end of this course, you will be able to:</p>
        <ul>
          <li>Build complete, full-stack web applications from scratch</li>
          <li>Understand modern web development best practices</li>
          <li>Create responsive, mobile-friendly websites</li>
          <li>Develop both front-end and back-end components</li>
          <li>Deploy applications to cloud platforms</li>
          <li>Collaborate on projects using Git and GitHub</li>
          <li>Debug and troubleshoot code effectively</li>
          <li>Continue learning and adapting to new technologies</li>
        </ul>
      </section>
    </div>

    <script>
      // Smooth scrolling logic (using courseLinks which are now dynamically active)
      document
        .querySelectorAll('.izumi-nav-links a[href^="#"]')
        .forEach((anchor) => {
          anchor.addEventListener("click", function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute("href"));

            document.querySelectorAll(".course-nav-link").forEach((link) => {
              link.classList.remove("active-course-link");
            });
            this.classList.add("active-course-link");

            if (target) {
              const navbarHeight =
                document.querySelector(".izumi-navbar").offsetHeight;
              const targetPosition = target.offsetTop - navbarHeight - 20;

              window.scrollTo({
                top: targetPosition,
                behavior: "smooth",
              });
            }
          });
        });

      // Scroll-spy logic
      const sections = document.querySelectorAll("section");
      const courseLinks = document.querySelectorAll(".course-nav-link");

      const options = {
        root: null,
        rootMargin: "-30% 0px -70% 0px",
        threshold: 0,
      };

      const observer = new IntersectionObserver((entries, observer) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const id = entry.target.getAttribute("id");

            courseLinks.forEach((link) => {
              link.classList.remove("active-course-link");
              if (link.getAttribute("href") === `#${id}`) {
                link.classList.add("active-course-link");
              }
            });
          }
        });
      }, options);

      sections.forEach((section) => {
        observer.observe(section);
      });

      /* Izumi Navbar Dropdown Script */
      document.addEventListener("DOMContentLoaded", function () {
        const profileContainer = document.querySelector(
          ".izumi-profile-container"
        );
        const dropdownContent = document.querySelector(
          ".izumi-dropdown-content"
        );

        if (profileContainer && dropdownContent) {
          profileContainer.addEventListener("click", (e) => {
            e.stopPropagation();
            dropdownContent.classList.toggle("active");
          });

          document.addEventListener("click", (e) => {
            if (!profileContainer.contains(e.target)) {
              dropdownContent.classList.remove("active");
            }
          });
        }
      });
      /* Izumi Navbar Dropdown Script - END */
      
      // Removed the redundant client-side courseData definition and helper functions.
      // Your backend must now ensure 'courseData' is passed to res.render().
    </script>
  </body>
</html>