<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Courses by Subject</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
        }
        .course-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .course {
            border: 1px solid #ddd;
            padding: 10px;
            margin: 5px;
            width: calc(50% - 10px);
            box-sizing: border-box;
        }
        .subject-header {
            text-align: center;
            margin-bottom: 10px;
            font-weight: bold;
            font-size: 1.2em;
            width: 100%;
        }

    </style>
    <link rel="stylesheet" href="/views/public/test.css">
</head>
<body>
    <h1>Courses by Subject</h1>

    <label for="subject-select">Select Subject:</label>
    <select id="subject-select">
        <option value="all">All Subjects</option>
    </select>

    <div id="courses-container">
    </div>

    <script>
        async function fetchCourses() {
            try {
                const response = await fetch('/courses_l');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const courses = await response.json();
                console.log("Fetched Courses:", courses);
                displayCourses(courses);
                populateSubjects(courses);
            } catch (error) {
                console.error('Error fetching courses:', error);
                document.getElementById('courses-container').innerHTML = '<p>Failed to load courses.</p>';
            }
        }

        function displayCourses(courses, selectedSubject = 'all') {
            const container = document.getElementById('courses-container');
            container.innerHTML = '';

            const filteredCourses = selectedSubject === 'all'
                ? courses
                : courses.filter(course => course.subject === selectedSubject);

            const subjects = [...new Set(filteredCourses.map(course => course.subject))];
            subjects.sort();

            subjects.forEach(subject => {
                const subjectCourses = filteredCourses.filter(course => course.subject === subject);

                if (subjectCourses.length > 0) {
                    const subjectHeader = document.createElement('div');
                    subjectHeader.className = 'subject-header';
                    subjectHeader.textContent = subject;
                    container.appendChild(subjectHeader);

                    const courseRow = document.createElement('div');
                    courseRow.className = 'course-row';

                    subjectCourses.forEach(course => {
                        const courseDiv = document.createElement('div');
                        courseDiv.className = 'course';
                        courseDiv.innerHTML = `
                            <a href="/is_enrolled?courseId=${course._id}" target="_top">
                            <h3>${course.title}</h3>
                            <p>Instructor ID: ${course.instructor_id}</p>
                            </a>
                        `;
                        courseRow.appendChild(courseDiv);
                    });

                    container.appendChild(courseRow);
                }
            });
        }

        function populateSubjects(courses) {
            const subjectSelect = document.getElementById('subject-select');
            const subjects = [...new Set(courses.map(course => course.subject))];
            subjects.sort();

            subjects.forEach(subject => {
                const option = document.createElement('option');
                option.value = subject;
                option.textContent = subject;
                subjectSelect.appendChild(option);
            });

            subjectSelect.addEventListener('change', () => {
                const selectedSubject = subjectSelect.value;
                displayCourses(courses, selectedSubject);
            });
        }

        fetchCourses();
    </script>
</body>
</html>